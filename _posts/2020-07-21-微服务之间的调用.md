---
layout:     post   				    # 使用的布局（不需要改）

title:      微服务之间的调用				# 标题 

subtitle:   微服务之间的调用 #副标题

date:       2020-07-21			# 时间

author:     wyx					# 作者

header-img: img/blog01.png 	#这篇文章标题背景图片

catalog: true 						# 是否归档

tags:								#标签
     - knowledge
---

服务调用有两种方式，一种是RPC方式，另一种是事件驱动（Event-driven）方式，也就是发消息方式。

消息方式是松耦合方式，比紧耦合的RPC方式要优越，但RPC方式如果用在适合的场景也有它的一席之地。

# 事件驱动（Event-Driven）方式

事件通知就是微服务之间不直接调用，而是通过发消息来进行合作。事件溯源有点像记账，它把所有的事件都记录下来，作为永久存储层，再在它的基础之上构建应用程序。

实际上从应用的角度来讲，它们并不应该分属一类，它们的用途完全不同。事件通知是微服务的调用（或集成）方式，应该和RPC分在一起。事件溯源是一种存储数据的方式，应该和数据库分在一起。



各个服务之间不需要任何的反馈使用事件驱动的方式

# 事件溯源(Event Sourcing)

第一，它的程序比较复杂，因为事件是一等公民，你必须把业务逻辑按照事件的方式整理出来，然后用事件来驱动程序。第二，如果你要想修改事件或事件的格式就比较麻烦，因为旧的事件已经存储在Event Store里了（事件就像日志，是只读的），没有办法再改。

# RPC方式

RPC的方式就是远程函数调用，像RESTFul，gRPC, [DUBBO](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247484647&idx=1&sn=9eb7e47d06faca20d530c70eec3b8d5c&scene=21#wechat_redirect) 都是这种方式。它一般是同步的，可以马上得到结果。在实际中，大多数应用都要求立刻得到结果，这时同步方式更有优势，代码也更简单。

# 服务网关（API Gateway）

前端ui可以直接访问网关来实现.

# 结论

微服务之间的调用有两种方式，RPC和事件驱动。事件驱动是更好的方式，因为它是松耦合的。但如果业务逻辑是紧耦合的，RPC方式也是可行的（它的好处是代码更简单），而且你还可以通过选取合适的协议（Protobuf gRPC）来降低这种紧耦合带来的危害。

由于事件溯源和事件通知的相似性，很多人把两者弄混了，但它们实际上是完全不同的东西。微服务的数量不宜太多，可以先创建比较大的微服务（更像是服务组合）。

如果你还是不能确定是否采用微服务架构，可以先从“内部微服务设计”开始，再逐渐拆分。