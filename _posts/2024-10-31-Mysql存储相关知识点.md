---
layout:     post              # 使用的布局（不需要改）

title:      Mysql存储相关     # 标题 

subtitle:  Mysql-存储

date:       2024-10-31      # 时间

author:     wyx-98          # 作者

header-img: img/workflow.jpg  #这篇文章标题背景图片

catalog: true             # 是否归档

tags:               #标签
     - knowledge
---
# Mysql的Innodb引擎底层数据存储机制剖析

## Mysql规定每一行规定最大字节数为65535

​		**Mysql中除了Blobs和Text这种大类型外，其他所有的字段（不包含隐藏列和记录头信息）占用的字节长度加起来不能超过65535**	

​		**所有字段的长度的字节数之和 + 所有变长字段的长度所占用的字节数之和 + Null值列表所占用的字节数 <= 65535**

​         当采用utf8编码的时候，如果该行已经有了一个int字段（4个字节，并且可以为空），再增加一个varchar类型的字段的话最大字符数只能为(65535-4-2-1)/3 = 21842个字符，其中的`4`为int字节数，`2`为varchar字符如果超过255的话需要用到2个字节来存储，所以减2, `1`因为int字段可以为空，所以需要使用一个字段作为null列表。同理，如果编码采用utf8mb4的话，varchar最大字符为(65535-4-2-1)/4=16381

​		`TEXT`：数据存储在单独的区域，不存在表的行数据中（MySQL 会对 `TEXT` 类型字段进行分离存储），因此不受一行规定最大字节数为65535的限制

​		补充：[Mysql的Dynamic行模式的存储信息包含哪些，各占用多少字节？](https://xiaolincoding.com/mysql/base/row_format.html#mysql-%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E6%94%BE%E5%9C%A8%E5%93%AA%E4%B8%AA%E6%96%87%E4%BB%B6)

## Mysql常用字段类型及占用字节数

### **数值类型**

| **数据类型** | 占用字节数 | 描述 |
| -------------------- | ------- | -------- |
| TINYINT | 1       | -128到127或0到255（无符号） |
| SMALLINT | 2 | -32768到32767或0-65535（无符号） |
| INT | 4 | -2,147,483,648 到 2,147,483,647 或 0 到 4,294,967,295（无符号） |
| BIGINT | 8 | -9,223,372,036,854,775,808 到 9,223,372,036,854,775,807 或 0 到 18,446,744,073,709,551,615（无符号） |
| FLOAT | 4 | 单精度浮点数 |
| DOUBLE | 8 | 双精度浮点数 |

### **字符串类型**

| 数据类型     | 占用字节数                         | 描述                          |
| ------------ | ---------------------------------- | ----------------------------- |
| char（N）    | N字节                              | 固定长度字符串，最多255个字节 |
| varchar（N） | L + 1 或 L + 2（L 为实际字符长度） | 可变长度字符串，最多65535字节 |
| TEXT         | L+2（L为实际字符长度）             | 最多 65,535 字节              |
| LONGTEXT     | L + 4（L 为实际字符长度）          | 最多 4,294,967,295 字节       |

### **日期和时间类型**

| 数据类型  | 占用字节数 | 描述                                                  |
| --------- | ---------- | ----------------------------------------------------- |
| DATETIME  | 8          | 日期和时间，格式为 'YYYY-MM-DD HH:MM'                 |
| TIMESTAMP | 4          | 时间戳，表示从 '1970-01-01 00:00:01' UTC 到现在的秒数 |

### 补充知识点

#### TINYINT表示带符号的数为什么是-128到127

> ​		因为计算机中为了统一加减计算规则，采用补码来表示负数。第一位为0来表示正数，因此最大值为+127（0111 1111），表示负数时，因为采用补码，可以多表示一个 -128（在八位编码系统中规定128（1000 0000）==>取反（0111 1111）+1 ==> 1000 0000 来表示-128）
>
> ​		针对于8位二进制采用补码表示，最多可表示2^n个数，也就是256个数，正数是1～127（0000 0001 ～ 0111 1111）是127个数，0（0000 0000），还剩下128个，所以规定（1111 1111 ～ 1000 0000）1000 0000 位-128，因按照补码规则1000 0000-1取反还是1000 0000，因此在二进制中规定它表示-128
>
> ​		补码表示负数的规则：正数的绝对值的反码+1。	

#### 为什么计算机要用补码表示法

> https://cloud.tencent.com/developer/article/2197876
>
> 补码表示法不仅削除了减法运算，还保证了0的唯一性

#### varchar和text的区别

> 最本质的区别：`varchar`存储在行内，`text`存储在外部存储中（会在数据表的行内存储一个指针），因此如果采用text进行存储的话，会涉及到I/O操作影响性能。text的长度是不计算在行内的65535的限制里的

#### DATETIME和TIMESTAMP的区别

> 最本质的区别： 
>
> `TIMESTAMP`存储的是带有时区的时间戳，存入的值都会被转成UTC时区的时间戳你，占用四个字节，数据库中展示都是`YYYY-MM-DD HH:MM:SS`，可以带毫秒，带毫秒后占用7个字节
>
> `DATETIME`存储的是不带时区的时间戳，占用8个字节，数据库中展示都是`YYYY-MM-DD HH:MM:SS`可以包含毫秒信息，但是带不带毫秒信息占用的都是8个字节

​		

